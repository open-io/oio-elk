# ELK version 6.2.4
version: '2'
services:
  elk:
    build:
     context: ./elk
    ports:
      - "5601:5601"
      - "9200:9200"
      - "9300:9300"
      - "5044:5044"
    volumes:
      - "./elk/elasticsearch/data:/var/lib/elasticsearch"
      - "./elk/elasticsearch/config:/opt/elasticsearch/config"
      - "./elk/elasticsearch/elasticsearch.default:/etc/default/elasticsearch"
      - "./elk/elasticsearch/curator:/opt/elasticsearch/curator"
      - "./elk/logstash/config/logstash.yml:/opt/logstash/config/logstash.yml"
      - "./elk/kibana/config:/opt/kibana/config"
      - "./elk/logstash/conf.d:/etc/logstash/conf.d"
    restart: always
    networks:
      - net
    environment:
      - "ES_JAVA_OPTS=${ES_JAVA_OPTS}"
      - "ES_CURATOR_DAYS=${ES_CURATOR_DAYS}"
      # - "ES_PATH_CONF=/opt/elasticsearch/config"


  filebeat:
      build:
        context: ./filebeat
      volumes:
        - "./filebeat/config/filebeat.yml:/usr/share/filebeat/filebeat.yml"
        - "./openio/log/oio/sds/OPENIO:/var/log/oio/sds/OPENIO"
      restart: always
      networks:
        - net
  openio-sds:
    build:
      context: ./openio
    ports:
     - "6007:6007"
    volumes:
     - "./openio/log/oio/sds/OPENIO:/var/log/oio/sds/OPENIO"
     - "./openio/etc/rsyslog.conf:/etc/rsyslog.conf"
    restart: always
    networks:
      - net
    # environment:
    #   - "KEYSTONE_ENABLED=true"
    #   - "KEYSTONE_URI=${IPADDR}:5000"
    #   - "KEYSTONE_URL=${IPADDR}:35357"
    #   - "REGION=us-east-1"

  # openstack-keystone:
  #   build:
  #     context: ./openstack
  #   ports:
  #     - "5000:5000"
  #     - "35357:35357"
  #   restart: always
  #   networks:
  #     - net
  #   environment:
  #     - "IPADDR=${IPADDR}"
  #     - "OS_IDENTITY_SERVICE_REGION=us-east-1"
  #     - "OS_OBJECTSTORE_SERVICE_REGION=us-east-1"

networks:
  net:
    driver: bridge
